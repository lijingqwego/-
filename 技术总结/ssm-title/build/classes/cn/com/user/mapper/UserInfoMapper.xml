<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.com.user.mapper.UserInfoMapper">
	<resultMap id="UserResultMap" type="cn.com.user.pojo.UserInfoCustom">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 01 16:23:39 CST 2017.
    -->
	    <id column="USERID" jdbcType="VARCHAR" property="id" />
	    <result column="LOGINID" jdbcType="VARCHAR" property="username" />
	    <result column="PASSWORD" jdbcType="VARCHAR" property="password" />
	    <result column="USERFLAG" jdbcType="DECIMAL" property="state" />
  	</resultMap>
  	<select id="findUserInfoByName" parameterType="java.lang.String" resultMap="UserResultMap">
		select USERID,LOGINID,PASSWORD,USERFLAG from P_UM_USER where LOGINID = #{username} and USERFLAG=1
  	</select>
	<!-- 
		根据用户编号，查询出来用户所具有的全角色列表
	 -->
	<resultMap id="roleResultMap" type="cn.com.user.pojo.RoleList">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 01 16:23:39 CST 2017.
    -->
	    <id column="AUTHORITYID" jdbcType="VARCHAR" property="roleid" />
	    <result column="CODE" jdbcType="VARCHAR" property="rolecode" />
  	</resultMap>
	 <select id="findUserRoleListByUserId" parameterType="java.lang.String" resultMap="roleResultMap">
	  	select C.AUTHORITYID,C.CODE FROM P_UM_AUTHORITY C where C.ENABLED=1 and C.AUTHORITYID IN(SELECT B.AUTHORITYID FROM P_UM_ROLE_AUTHORITY B
     WHERE B.ROLEID IN(SELECT A.ROLEID FROM P_UM_USER_ROLE A WHERE A.USERID=#{userid})) 
	 </select>
</mapper>